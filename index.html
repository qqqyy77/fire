<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>人皮刺繡：縫隙</title>
    <style>
        :root {
            --font-main: "Songti TC", "Noto Serif TC", serif;
            --accent-red: #a80000;
            --accent-gold: #c5a000;
            --text-color: #e0e0e0;
            --scene-bg-color: #050505;
            --overlay-bg: rgba(10, 10, 10, 0.9);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            font-family: var(--font-main);
            color: var(--text-color);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: fixed;
        }

        #game-view {
            width: 100%;
            height: 100%;
            position: relative;
            background: var(--scene-bg-color);
            transition: background 0.5s;
        }

        /* --- 背景圖片層 (結局第二階段顯示) --- */
        #bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .bg-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            /* 結局圖片稍微保持一點亮度，讓人想收藏 */
            filter: brightness(0.85); 
        }

        /* --- UI層：文字與選項 --- */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; 
            pointer-events: none;
            transition: opacity 0.5s;
        }

        /* 文字滾動容器 */
        .text-scroll-box {
            pointer-events: auto;
            width: 100%;
            height: 95vh; 
            background: var(--overlay-bg);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
            padding: 40px 30px 100px 30px; 
            animation: slideUp 0.4s ease-out;
            box-shadow: 0 -10px 40px rgba(0,0,0,1);
            scrollbar-width: none;
        }
        .text-scroll-box::-webkit-scrollbar { display: none; }

        .story-text {
            font-size: 1.2rem;
            line-height: 1.9;
            color: #ddd;
            margin-bottom: 40px;
            white-space: pre-wrap;
            margin-top: 10px; 
        }

        .choices-box {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
        }

        button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 22px;
            font-size: 1.05rem;
            font-family: var(--font-main);
            text-align: left;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            line-height: 1.4;
        }

        button:active {
            background: var(--accent-red);
            border-color: var(--accent-red);
            transform: scale(0.98);
        }

        /* --- ★ 結局專用層 (雙按鈕) --- */
        #final-layer {
            position: absolute;
            bottom: 40px;
            width: 100%;
            /* 使用 flex 垂直排列兩個按鈕 */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px; /* 按鈕間距 */
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease 1s;
        }
        
        /* 結局按鈕通用樣式 */
        .final-action-btn {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            padding: 18px 30px;
            font-size: 1rem;
            border-radius: 50px;
            pointer-events: auto;
            text-align: center;
            justify-content: center;
            width: 80%; /* 按鈕寬度 */
            letter-spacing: 0.1em;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            font-family: var(--font-main);
            cursor: pointer;
            transition: all 0.3s;
        }

        /* 強調「獲得圖片」的按鈕樣式 */
        .accent-btn {
             background: rgba(197, 160, 0, 0.15);
             border-width: 2px;
             font-weight: bold;
        }

        .final-action-btn:active {
            transform: scale(0.95);
            background: var(--accent-gold);
            color: #000;
        }

        /* --- ★ 開始畫面 (調整版) --- */
        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20;
            background: #080808;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            /* 減少上方留白，讓整體往上移 */
            padding-top: 3vh; 
        }

        .start-header {
            text-align: center;
            /* 減少標題與圖片的間距 */
            margin-bottom: 2vh; 
            z-index: 30;
            width: 100%;
        }

        .start-header h1 {
            font-weight: normal;
            letter-spacing: 0.3em;
            margin: 0 0 5px 0;
            font-size: 1.5rem;
            color: #fff;
        }

        .start-header p {
            font-size: 0.9rem;
            color: #888;
            margin: 0;
        }

        /* 卡片輪播容器 */
        .char-carousel {
            width: 100%;
            display: flex;
            flex-direction: row;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            gap: 20px;
            padding: 0 50px;
            align-items: center; 
            scrollbar-width: none;
            /* 讓容器佔滿剩餘空間，確保卡片能盡量大 */
            flex: 1; 
            /* 底部留一點空間 */
            padding-bottom: 20px;
        }
        .char-carousel::-webkit-scrollbar { display: none; }

        .char-card {
            /* ★ 關鍵修改：增加卡片高度，讓圖片更大 */
            height: 65vh; 
            aspect-ratio: 9/16; 
            flex-shrink: 0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            scroll-snap-align: center;
            border: 1px solid #333;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            background: #000;
        }

        .char-card img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            filter: brightness(0.9); 
        }

        .char-card:active {
            border-color: var(--accent-red);
            transform: scale(0.98);
        }

        .char-info {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 30px 10px 15px 10px;
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            text-align: center;
        }

        .char-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #fff;
            display: block;
            margin-bottom: 5px;
            text-shadow: 0 2px 5px rgba(0,0,0,0.8);
        }
        
        .char-role {
            font-size: 0.85rem;
            color: var(--accent-gold);
        }

        /* --- 輔助樣式 --- */
        .hidden { display: none !important; }
        
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .highlight-gold { color: var(--accent-gold); font-weight: bold;}
        .highlight-red { color: var(--accent-red); font-weight: bold;}
        .highlight-dim { color: #999; font-size: 0.9em; display: block; margin-top: 5px;}

        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translateX(0); } 25% { transform: translateX(-5px) rotate(-1deg); } 75% { transform: translateX(5px) rotate(1deg); } 100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

<div id="game-view">
    
    <div id="bg-layer">
        <img id="current-bg" class="bg-img" src="" alt="">
    </div>

    <div id="ui-layer" class="hidden">
        <div class="text-scroll-box">
            <div id="story-text" class="story-text"></div>
            <div id="choices-box" class="choices-box"></div>
        </div>
    </div>

    <div id="final-layer">
        <button id="download-btn" class="final-action-btn accent-btn">獲得結局圖片</button>
        <button id="home-btn" class="final-action-btn" onclick="startGame('start')">返回首頁</button>
    </div>

    <div id="start-screen">
        <div class="start-header">
            <h1>人皮刺繡</h1>
            <p>縫隙中的故事</p>
        </div>
        
        <div class="char-carousel">
            <div class="char-card" onclick="startGame('fire_intro')">
                <img src="fire1.jpg" alt="林火">
                <div class="char-info">
                    <span class="char-name">林火</span>
                    <span class="char-role">上帝 / 鐮刀 / 農夫</span>
                </div>
            </div>
            <div class="char-card" onclick="startGame('hui_intro')">
                <img src="fire2.jpg" alt="灰灰">
                <div class="char-info">
                    <span class="char-name">灰灰</span>
                    <span class="char-role">脂肪 / 陰影 / 餐盤</span>
                </div>
            </div>
            <div class="char-card" onclick="startGame('ether_intro')">
                <img src="fire3.jpg" alt="以太">
                <div class="char-info">
                    <span class="char-name">以太</span>
                    <span class="char-role">痛覺 / 人偶 / 虛無</span>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    // 遊戲數據庫
    const gameData = {
        // --- 林火路線 ---
        fire_intro: {
            text: "你看著眼前的田野。雖然她們看起來像是女人——河明、以太、灰灰——但在你眼裡，那只是待割的<span class='highlight-gold'>野草</span>。\n\n你聽見樹對你說：「你要謙卑。」\n你笑著回答：「我不需要上帝，我就是上帝。」\n\n今天，你要如何處置這些野草？",
            choices: [
                { text: "使用【照相機】。拍下她們，奪走靈魂。", target: "fire_camera" },
                { text: "使用【鐮刀】。她們需要痛苦才能重生。", target: "fire_sickle" }
            ]
        },
        fire_camera: {
            text: "你舉起相機。對焦。\n\n灰灰在鏡頭裡無所遁形。照片背後寫著：「想你的時刻。」\n\n這不是愛，這是狩獵。河明看見照片後，交出了她所有的積蓄。\n\n你看著存摺上的數字，這是一種收割。",
            choices: [
                { text: "繼續索取，直到她變成空氣。", target: "fire_end_success" },
                { text: "感到一絲憐憫。", target: "fire_end_fail" }
            ]
        },
        fire_sickle: {
            text: "你走進野草之間。草割破了你的手背，流出血來。\n\n你嗅到了血的氣味。以太正在床上等你，像一頭受傷的獸。\n\n你手裡拿著工具。她需要殘忍，你很清楚。",
            choices: [
                { text: "給予她毀滅性的痛，這是她要的安全感。", target: "fire_sadism" },
                { text: "停下來，看著她的眼睛。", target: "fire_end_fail" }
            ]
        },
        fire_sadism: {
            text: "你沒有停下。你用言語和行為將她拆解。\n\n「愛的意思就是，我可以任意傷害你。」你心裡這樣想。\n\n但在夢裡，你看到她為你死去的樣子。那是最美的獻祭。\n\n<span class='highlight-gold'>你成功種植了你的上帝。</span>",
            choices: [
                { text: "重新開始", target: "start" }
            ]
        },
        // ★ 結局節點：設定圖片路徑
        fire_end_success: {
            text: "河明消失了，像空氣一樣淡。灰灰變胖了，然後被你拋棄。\n\n你坐在空蕩蕩的田野上，雖然孤獨，但你感到神聖。\n沒有任何關係是完全平等的，你是贏家。\n\n<span class='highlight-gold'>結局：荒原上的上帝</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire1.jpg" }]
        },
        fire_end_fail: {
            text: "那一瞬間的猶豫，讓你從神壇跌落。\n\n你意識到自己只是一個飢餓的普通男人。野草瘋長，將你淹沒。\n\n<span class='highlight-red'>結局：凡人的飢餓</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire1.jpg" }]
        },

        // --- 灰灰路線 ---
        hui_intro: {
            text: "天氣太熱了。你蹲在地上，試圖把自己縮進最深最黑的影子裡。\n\n林火端來了食物，那是你最討厭的濃湯。\n\n他盯著你。「吃下去，」他的眼神說，「這也是愛。」\n\n你的胃在翻騰。",
            choices: [
                { text: "【進食】 順從他，讓他滿意。", target: "hui_eat" },
                { text: "【躲藏】 拒絕進食，退縮到影子深處。", target: "hui_hide" }
            ]
        },
        hui_eat: {
            text: "你張開嘴。食物滑進喉嚨，像石頭一樣沉重。\n\n他在微笑。那是捕食者的微笑。\n\n你看著鏡子，你變瘦了，這很不合理。你正在被他「吃掉」。",
            choices: [
                { text: "繼續這樣下去，直到消失。", target: "hui_bad_end" },
                { text: "離開他，用「暴食」奪回控制權。", target: "hui_escape" }
            ]
        },
        hui_escape: {
            text: "你離開了那個房間。你拿出餐單，然後把它揉爛。\n\n你開始渴望脂肪。你的身體開始膨脹，像一層盔甲。身旁的座位是空的，沒人能擠壓你。\n\n<span class='highlight-gold'>結局：脂肪堡壘</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire2.jpg" }]
        },
        hui_hide: {
            text: "你拒絕張開嘴。林火的表情變了。\n\n那團灰霧開始令人窒息。你試圖躲進影子，但影子也是他的。你發現自己無處可逃。\n\n<span class='highlight-red'>結局：被霧吞噬</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire2.jpg" }]
        },
        hui_bad_end: {
            text: "你變得越來越瘦，越來越聽話。\n\n你只是一具被他擺弄的人偶。有一天，他厭倦了，把你扔在角落。\n\n<span class='highlight-red'>結局：人皮刺繡</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire2.jpg" }]
        },

        // --- 以太路線 ---
        ether_intro: {
            text: "從小，你就試圖保持腹部的空洞。\n但現在，那種虛無讓你恐懼。\n\n阿火拿著工具站在你面前。他的眼神是唯一的熱源。\n\n「你知道你對我做了什麼嗎？」你問。",
            choices: [
                { text: "因為恐懼而順從，渴望他的殘忍。", target: "ether_pain" },
                { text: "尋找另一種填充物（木）。", target: "ether_wood" }
            ]
        },
        ether_pain: {
            text: "他給你劇痛。你慘叫，但內心卻平靜了。\n\n「愛的意思就是，我可以任意傷害你。」他說。\n\n你在毀滅中確認存在。\n\n<span class='highlight-red'>結局：痛覺成癮者</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire3.jpg" }]
        },
        ether_wood: {
            text: "你離開了火，遇到了木。\n\n木是安全的。他給你買了房子，全是「實」的牆壁。\n\n在一場遊戲中，木擁抱你。所有人都在歡呼，但你卻感到前所未有的寂寞。",
            choices: [
                { text: "接受這份虛假的安全。", target: "ether_hollow_end" },
                { text: "懷念火帶來的毀滅。", target: "ether_regret" }
            ]
        },
        ether_hollow_end: {
            text: "你穿著白色的禮服，扮演著幸福的角色。\n\n木抱著的不是你，是那個角色。你在安全的房子裡，慢慢變成了一個幽靈。\n\n<span class='highlight-gold'>結局：衣櫃裡的幽靈</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire3.jpg" }]
        },
        ether_regret: {
            text: "在深夜，你敲著實心的牆壁，聽不到回音。\n\n你想起了火的暴虐。你打開窗戶，看著下方。或許墜落的痛楚能讓你醒過來？\n\n<span class='highlight-red'>結局：未完成的墜落</span>",
            choices: [{ text: "凝視結局畫面", type: "visual_end", image: "fire3.jpg" }]
        }
    };

    // DOM 元素
    const startScreen = document.getElementById('start-screen');
    const uiLayer = document.getElementById('ui-layer');
    const finalLayer = document.getElementById('final-layer');
    const storyTextEl = document.getElementById('story-text');
    const choicesBoxEl = document.getElementById('choices-box');
    const bgLayer = document.getElementById('bg-layer');
    const bgImgEl = document.getElementById('current-bg');
    const gameView = document.getElementById('game-view');
    const textScrollBox = document.querySelector('.text-scroll-box');
    const downloadBtn = document.getElementById('download-btn');

    // 開始遊戲
    function startGame(startSceneKey) {
        if(startSceneKey === 'start') {
            location.reload(); 
            return;
        }

        startScreen.classList.add('hidden');
        uiLayer.classList.remove('hidden');
        renderScene(startSceneKey);
    }

    // 觸發結局圖片顯示
    function showFinalVisual(imgSrc) {
        // 1. 設定圖片
        bgImgEl.src = imgSrc;
        
        // 2. 設定下載按鈕功能
        downloadBtn.onclick = () => {
            downloadImage(imgSrc);
        };

        // 3. 隱藏文字層，顯示圖片與按鈕層
        uiLayer.style.opacity = 0;
        setTimeout(() => {
            uiLayer.classList.add('hidden');
            uiLayer.style.opacity = 1;
        }, 500);

        bgLayer.style.opacity = 1;
        finalLayer.style.opacity = 1;
    }

    // ★ 新增：下載圖片功能
    function downloadImage(url) {
        // 創建一個暫時的連結元素來觸發下載
        const a = document.createElement('a');
        a.href = url;
        // 從路徑中提取檔名作為下載後的檔名
        a.download = url.split('/').pop() || 'ending_image.jpg';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    // 渲染場景
    function renderScene(sceneKey) {
        const scene = gameData[sceneKey];

        // 預設狀態
        bgLayer.style.opacity = 0;
        finalLayer.style.opacity = 0;

        // 更新文字
        storyTextEl.innerHTML = scene.text;
        textScrollBox.scrollTop = 0;

        // 生成選項
        choicesBoxEl.innerHTML = '';
        if (scene.choices) {
            scene.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.innerHTML = choice.text;
                
                btn.onclick = () => {
                    // 判斷是否為結局看圖按鈕
                    if (choice.type === "visual_end") {
                        showFinalVisual(choice.image);
                    } else {
                        if (sceneKey === 'fire_sickle' || sceneKey === 'ether_intro') {
                            gameView.classList.add('shake');
                            setTimeout(() => gameView.classList.remove('shake'), 500);
                        }
                        renderScene(choice.target);
                    }
                };
                choicesBoxEl.appendChild(btn);
            });
        }
    }

</script>

</body>
</html>